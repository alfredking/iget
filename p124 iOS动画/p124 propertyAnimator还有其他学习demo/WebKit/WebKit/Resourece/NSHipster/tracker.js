/**
 * jamalytics-tracker (0.1.0)
 * 2018-10-13
 */

!function(){"use strict";function e(e,n){var t,o,r=arguments,a=function(){t&&(clearTimeout(t),t=null)},i=function(){clearTimeout(t),t=setTimeout(function(){t=null,e.apply(o,r)},n)};return i.cancel=a,i.flush=function(){a(),e.apply(o,r)},i}var n=Math.round,t=function(e){return encodeURIComponent(""+e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16)})},o=void 0;"undefined"!=typeof navigator&&"function"==typeof navigator.sendBeacon?o=function(e,n){navigator.sendBeacon(e,n)}:"function"==typeof fetch?o=function(e,n){fetch(e,{method:"POST",mode:"no-cors",cache:"no-cache",keepalive:!0,referrer:"no-referrer-when-downgrade",body:n}).catch(function(e){})}:"function"==typeof XMLHttpRequest&&(o=function(e,n){var t=new XMLHttpRequest;t.open("POST",e,!1),t.send(n)});var r=o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i="1"===(navigator.doNotTrack||navigator.msDoNotTrack||window.doNotTrack),c=window.localStorage.getItem("jamalytics-opt-out");if(!i&&!c){var d=document.querySelector('script[type="application/jamalytics+json"]'),u=JSON.parse(d.textContent),s=u.endpoint,l=u.property;if(s&&l){var p=document.createElement("link");p.rel="preconnect",p.href=s,p.setAttribute("crossorigin","anonymous"),document.head.appendChild(p);var m=window.sessionStorage.getItem("session_id");m||(m=function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",n=window.crypto||window.msCrypto;if(void 0!==n&&"function"==typeof n.getRandomValues)return e.replace(/[xy]/g,function(e){var t=0|n.getRandomValues(new Uint8Array(1))[0]%16;return("x"==e?t:8|3&t).toString(16)});var t=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(t+=performance.now()),e.replace(/[xy]/g,function(e){var n=0|(t+16*Math.random())%16;return t=Math.floor(t/16),("x"===e?n:8|3&n).toString(16)})}(),window.sessionStorage.setItem("session_id",m));var f=0,v=function(e){var n=function(e){if("function"==typeof URL){var n=e.querySelector('link[rel="canonical"]');if(n&&n.href)return new URL(n.href)}return e.location}(document),o=Object.assign({},e,{v:1,tid:l,cid:m,dh:n.hostname,dp:n.pathname,ds:"web",top:f});r(function(e,n){var t=s;return t.endsWith("/")&&n.startsWith("/")?t.slice(0,-1)+n:t.endsWith("/")||n.startsWith("/")?t+n:t+"/"+n}(0,"/collect"),function(e){var n=[];for(var o in e){var r=e[o];(r||0===r)&&n.push(t(o)+"="+t(r))}return n.join("&")}(o))};window.addEventListener("appinstalled",function(){v({t:"event",ec:"window",ea:"appinstalled"})}),window.addEventListener("beforeprint",function(){v({t:"event",ec:"window",ea:"beforeprint"})});var g=function(e){if(e&&e.target&&e.target.href&&-1===e.target.href.indexOf(window.location.hostname)){var n=e.target,t=n.href,o=e.pageX&&e.pageY?e.pageX+","+e.pageY:null,r=function(e){for(;e&&e!==document;e=e.parentNode)if(e.id)return e.id;return null}(n);v({t:"event",ec:"document",ea:e.type||"click",el:t,exy:o,linkid:r})}};document.addEventListener("click",g),document.addEventListener("contextmenu",g),document.addEventListener("dblclick",g);var w=window.onerror;window.onerror=function(e,n,t,o,r){w&&w.apply(void 0,arguments),v({t:"exception",exd:(r?r.name:"Error")+' "'+(e||"Unknown")+'" ('+n+"#"+(t||"")+":"+(o||"")+")"})},document.addEventListener("languagechange",function(){var e=navigator.languages[0];v({t:"event",ec:"document",ea:"languagechange",ul:e})}),window.addEventListener("load",function(){if("object"===a(window.performance)&&"object"===a(window.performance.timing)){var e;switch(window.performance.navigation.type){case PerformanceNavigation.TYPE_NAVIGATE:e="navigate";break;case PerformanceNavigation.TYPE_RELOAD:e="reload";break;case PerformanceNavigation.TYPE_BACK_FORWARD:e="back_forward"}var t=n(window.performance.now()),o=window.performance.timing,r=o.loadEventEnd-o.loadEventStart,i=o.domainLookupEnd-o.domainLookupStart,c=o.loadEventEnd-o.navigationStart,d=o.redirectEnd-o.redirectStart,u=o.connectEnd-o.connectStart,s=o.responseStart-o.navigationStart,l=o.domComplete-o.domLoading,p=o.responseEnd-o.responseStart,m=navigator.connection||navigator.mozConnection||navigator.webkitConnection,f=m&&m.type,g=navigator.connection&&(navigator.connection.downlinkMax||navigator.connection.downlink),w=navigator.connection&&navigator.connection.uplink,h=window.screen&&window.screen.availWidth+"x"+window.screen.availHeight,x=document.documentElement&&document.documentElement.clientWidth+"x"+document.documentElement.clientHeight,y=window.screen&&window.screen.colorDepth,E=window.devicePixelRatio;v({t:"timing",utc:"performance",utv:e,utt:t,plt:r,dns:i,pdt:c,rrt:d,tcp:u,srt:s,dit:l,clt:p,xt:f,xd:g,xu:w,sr:h,vp:x,sd:y,dpr:E})}}),window.addEventListener("pageshow",function(e){if(!e.persisted){setInterval(function(){f+=1},1e3);var n={t:"pageview",dt:document.title,dr:document.referrer,ul:navigator.languages[0]},t=function(e){for(var n={},t=document.location.search.replace(/^\?/,"").split("&"),o=0;o<t.length;o++){var r=t[o].split("="),a=decodeURIComponent(r[0]),i=decodeURIComponent(r[1]);if(void 0===n[a])n[a]=decodeURIComponent(i);else if("string"==typeof n[a]){var c=[n[a],decodeURIComponent(i)];n[a]=c}else n[a].push(decodeURIComponent(i))}return n}(),o=t.utm_source,r=t.utm_medium,a=t.utm_campaign,i=t.utm_term,c=t.utm_content;o&&(n=Object.assign({},n,{cn:a,cs:o,cm:r,ck:i,cc:c})),v(n)}});var h=function(e){var n=e.target;if(!n)return!1;var t=n.src,o=n.played.toString();v({t:"event",ec:n.tagName,ea:e.type,el:t,ev:o,dt:(""===n.title?null:n.title)||n.text})};h=e(h,1e3),document.addEventListener("play",h),document.addEventListener("pause",h),document.addEventListener("seeked",h),document.addEventListener("timeupdate",h),window.addEventListener("pushstate",function(e){setTimeout(function(){var n=document.location.hostname,t=e.path,o=document.title;v({t:"pageview",dh:n,dp:t,dt:o})},0)});var x=0,y=function(){var e=document.documentElement,t=document.body,o="scrollTop",r="scrollHeight",a=x,i=(e[o]||t[o])/((e[r]||t[r])-e.clientHeight);x=Math.min(Math.max(x,i),1);var c=n(100*x);x>a&&v({t:"event",ec:"document",ea:"scroll",ev:c})};y=e(y,5e3),document.addEventListener("scroll",y,{passive:!0})}}}();
